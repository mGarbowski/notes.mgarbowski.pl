<!doctype html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>08-malware</title>
    <link rel="stylesheet" href="../style.css">

    <!--    Load mathjax from cdn to render latex equations-->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<div class="prev-next-links">
    
    <div class="index-links-prev">
        <a href="07-bezpieczenstwo-aplikacji-c.html">Poprzedni: 07-bezpieczenstwo-aplikacji-c.html</a>
    </div>
    

    
    <div class="index-links-next">
        <a href="09-bezpieczenstwo-aplikacji-webowych.html">Następny: 09-bezpieczenstwo-aplikacji-webowych.html</a>
    </div>
    
    <div class="return-link">
        <a href="..">Powrót</a>
    </div>
</div>
<div class="container">
    <div class="index-links-wrapper">
        <h2>Bezpieczeństwo systemów i sieci</h2>
        <div class="index-links">
            <ul>
                
                <li><a href="00-organizacja.html">00-organizacja.html</a></li>
                
                <li><a href="01-wstep.html">01-wstep.html</a></li>
                
                <li><a href="02-szyfrowanie.html">02-szyfrowanie.html</a></li>
                
                <li><a href="03-funkcje-skrotu.html">03-funkcje-skrotu.html</a></li>
                
                <li><a href="04-infrastruktura-klucza-publicznego.html">04-infrastruktura-klucza-publicznego.html</a></li>
                
                <li><a href="05-zagrozenia-sieciowe.html">05-zagrozenia-sieciowe.html</a></li>
                
                <li><a href="06-systemy-zapewniajace-bezpieczenstwo.html">06-systemy-zapewniajace-bezpieczenstwo.html</a></li>
                
                <li><a href="07-bezpieczenstwo-aplikacji-c.html">07-bezpieczenstwo-aplikacji-c.html</a></li>
                
                <li><a href="08-malware.html">08-malware.html</a></li>
                
                <li><a href="09-bezpieczenstwo-aplikacji-webowych.html">09-bezpieczenstwo-aplikacji-webowych.html</a></li>
                
                <li><a href="10-bezpieczenstwo-systemow-operacyjnych.html">10-bezpieczenstwo-systemow-operacyjnych.html</a></li>
                
                <li><a href="11-vpn.html">11-vpn.html</a></li>
                
                <li><a href="12-bezpieczenstwo-systemow-automatyki-przemyslowej.html">12-bezpieczenstwo-systemow-automatyki-przemyslowej.html</a></li>
                
                <li><a href="13-systemy-honeypot.html">13-systemy-honeypot.html</a></li>
                
                <li><a href="14-polityka-bezpieczenstwa.html">14-polityka-bezpieczenstwa.html</a></li>
                
            </ul>
        </div>
    </div>
    <div class="content-wrapper">
        <main>
            <p>Jeśli strona była dla Ciebie pomocna, możesz wesprzeć mnie w jej utrzymaniu na <a href="https://buycoffee.to/mgarbowski">buycoffee.to/mgarbowski</a></p>
            <h1 id="malware">Malware</h1>
<h2 id="złośliwy-kod">Złośliwy kod</h2>
<ul>
<li>Malware (malicious software)
<ul>
<li>wirusy robaki</li>
<li>specjalizowane oprogramowanie (budowa botnetów, skanowanie
ofiar)</li>
<li>ransomware</li>
</ul></li>
<li>W dzisiejszym złośliwym kodzie nie ma jasnego podziału na
funkcjonalności wirusa, robaka, backdooru itd.</li>
<li>Najczęściej złośliwy kod zostaje uruchomiony bez wiedzy
użytkownika</li>
<li>Uruchomiony program może dokonać dowolnych zmian w systemie</li>
<li>Jeśli cokolwiek złośliwego zostało uruchomione to należy wyczyścić
maszynę
<ul>
<li>i najlepiej pozmieniać wszystkie hasła</li>
</ul></li>
</ul>
<h2 id="podstawowe-pojęcia">Podstawowe pojęcia</h2>
<ul>
<li>Wirusy - samopropagujący się kod, do którego uruchomienia potrzebna
jest interwencja użytkownika (włożenie dyskietki, włączenie makra itd)
<ul>
<li>infekcje boot-sectora nośnika</li>
<li>zainfekowane pliki wykonywalne</li>
<li>infekcje dysków flash</li>
<li>infekcje plików dokumentów (makra)</li>
</ul></li>
<li>Robak - samopropagujący się kod, do rozprzestrzeniania
wykorzystujący sieć, nie potrzbuje interwencji użytkownika aby przenosić
się między infekowanymi systemami
<ul>
<li>po infekcji maszyna samodzielnie zaczyna poszukiwać kolejnych ofiar
i je infekować</li>
</ul></li>
<li>Backdoor - oprogramowanie umożliwiające zdalny dostęp do systemu
nieautoryzowanym użytkownikom bez wiedzy administratora czy
właściciela</li>
<li>Koń trojański - oprogramowanie, które wydaje się mieć pożyteczne i
niegroźne funkcje lecz posiadające ukryte nieznane osobie uruchamiającej
działanie
<ul>
<li>najczęściej zawiera backdoor</li>
</ul></li>
<li>Spyware - oprogramowanie pisane w celu szpiegowania użytkownika
komputera
<ul>
<li>loginy i hasła</li>
<li>naciskane klawisze (keylogger)</li>
<li>odwiedzane strony</li>
<li>adresaci, treści wysyłanych listów</li>
<li>dane na temat komputera, systemu operacyjnego, oprogramowania</li>
</ul></li>
<li>Ransomware - oprogramowanie, które blokuje dostęp do komputera lub
danych w celu uzyskania okupu
<ul>
<li>winlocker - blokuje dostęp do maszyny</li>
<li>cryptolocker - szyfruje dane</li>
</ul></li>
<li>Exploit - specjalnie spreparowane dane umożliwiające wykorzystanie
podatności
<ul>
<li>specjalnie spreparowany plik</li>
<li>żądanie do serwera</li>
<li>sesja komunikacyjna</li>
<li>dane wprowadzone przez użytkownika do aplikacji</li>
</ul></li>
<li>Shellcode
<ul>
<li>kawałek kodu maszynowego</li>
<li>najczęściej ściąga plik z internetu i uruchamia</li>
<li>niewielki program uruchamiany w wyniku wystąpienia błędu</li>
<li>ściąga malware (first stage)</li>
<li>dropper / downloader - wiele kroków programów pobierających programy
przed pobraniem właściwego malware’u</li>
<li>mogą być często zmieniane żeby utrudnić wykrycie</li>
</ul></li>
</ul>
<h2 id="rodzaje-shellcode">Rodzaje shellcode</h2>
<h3 id="port-bind-connect-back">Port-bind, connect-back</h3>
<ul>
<li>Uruchamia shella</li>
<li>Tworzy gniazdo
<ul>
<li>nasłuchujące (port-bind)</li>
<li>łączące się pod wskazany adres (connect-back)</li>
</ul></li>
<li>Atakując podłącza się i wysyła komendy, które zostaną
uruchomione</li>
</ul>
<h3 id="download-and-execute">Download and execute</h3>
<ul>
<li>Instrukcje pozwalające ściągnąć dalsze stopnie robaka bezpośrednio w
kodzie</li>
<li>Wykorzystanie funkcji systemowych
<ul>
<li>URLDownloadToFile</li>
<li>CreateProcess</li>
<li>WinExec</li>
</ul></li>
<li>Program zapisany jako biblioteka, a nie wykonywalny</li>
</ul>
<h3 id="egg-hunt">Egg hunt</h3>
<ul>
<li>Wykorzystywane kiedy bufory są za małe, żeby zmieścić całły
exploit</li>
<li>Umieszcza się fragmenty w oddzielnych kawałkach</li>
<li>Ostatni fragment zbiera kawałki w jedno miejsce i je uruchamia</li>
<li>Dzisiaj niepotrzebne, bo pamięci są większe</li>
</ul>
<h2 id="shellcode-a-zwykły-program">Shellcode a zwykły program</h2>
<ul>
<li>Nie jest normalnie ładowany do pamięci przez system operacyjny tylko
wykorzystuje buffer overflow itd.</li>
<li>Nie wiadomo pod jakim adresem będzie uruchomiony</li>
<li>Problemy z ograniczeniami na znaki (np. nie może być bajtu
<code>0x00</code>)</li>
<li>Mały rozmiar</li>
<li>Często zbiera się kawałki gotowców</li>
<li>Kod uruchomiony pod nieznanym adresem</li>
<li>Brak informacji gdzie znajdują się funkcje systemowe</li>
</ul>
<h2 id="uruchomienie-programu-w-formacie-pe">Uruchomienie programu w
formacie PE</h2>
<ul>
<li>Załadowanie segmentów kodu i danych pod odpowiednie adresy</li>
<li>Odczytanie listy importowanych funkcji z systemowych bibliotek
ładowanych dynamicznie</li>
<li>Załadowanie wskazanych bibliotek dynamicznych do przestrzeni
adresowej procesu</li>
<li>Uaktualnienie adresów w tablicy importowanych funkcji</li>
</ul>
<h2 id="mechanizmy-stosowane-w-shellcode">Mechanizmy stosowane w
shellcode</h2>
<ul>
<li>Get PC - poznanie własnego adresu
<ul>
<li>wykorzystuje normalne działanie instrukcji call - wrzucanie adresu
powrotu na stos</li>
<li>informacja często jest potrzebna do zdeszyfrowania dalszej części
shellcodu</li>
</ul></li>
<li>Szyfrowanie
<ul>
<li>uniknięcie wykrycia</li>
<li>usunięcie nielegalnych znaków</li>
<li>najczęściej zwykłe xor</li>
</ul></li>
<li>Procedura odszukania struktur systemowych dotyczących danego procesu
i wyszukanie adresów interesujących funkcji
<ul>
<li>każdy proces ma strukturę PEB</li>
<li>w niej jest adres pierwszej DLL</li>
<li>pierwsza DLL musi mieć procedurę ładowania biblioteki</li>
</ul></li>
</ul>
<h3 id="peb">PEB</h3>
<ul>
<li>Process Environment Block</li>
<li>Struktura danych zawierająca wszystkie istotne informacje dotyczące
danego procesu</li>
<li>Umieszczona w przestrzeni adresowej procesu</li>
<li><ol start="13" type="1">
<li>32-bitowe słowo wskazywane przez rejestr FS</li>
</ol></li>
<li>Pozwala uzyskać dostęp do listy załadowanych przez proces bibliotek
<ul>
<li>nazwy i adresy eksportowanych funkcji</li>
</ul></li>
</ul>
<h2 id="motywacje-atakujących">Motywacje atakujących</h2>
<ul>
<li>Dawniej - pokazanie umiejętności itd.</li>
<li>Obecnie - chęć zarobienia
<ul>
<li>głównym celem jest okradanie użytkowników lub wyłudzanie
pieniędzy</li>
</ul></li>
<li>Należy patrzeć na atakujących jak na biznes
<ul>
<li>przeciwdziałanie to przede wszystkim podnoszenie ich kosztów</li>
</ul></li>
</ul>
<h3 id="sposoby-na-zarabianie">Sposoby na zarabianie</h3>
<ul>
<li>Dochody z reklam
<ul>
<li>właściciel botnetu zakłada stronę i umieszcza na niej płatne
ogłoszenie</li>
<li>maszyny zombie klikają reklamy</li>
</ul></li>
<li>Wykorzystanie zainfekowanych maszyn do kopania kryptowalut
<ul>
<li>mało wydajne ale atakujący nie płaci za prąd i internet</li>
</ul></li>
</ul>
<h2 id="botnet">Botnet</h2>
<ul>
<li>Jedna przejęta maszyna nie ma dużej wartości</li>
<li>Kontrola nad setką, tysiącem maszyn już ma dużą wartość
<ul>
<li>więc każda maszyna w sieci ma wartość dla atakującego</li>
<li>każdą maszynę w sieci należy i warto chronić</li>
</ul></li>
<li>Bot, maszyna zombie - pojedynczy zainfekowany komputer, kontrolowany
zdalnie</li>
<li>Botmaster, serwer C&amp;C (Command and Control)
<ul>
<li>maszyna dzięki której atakujący może kontrolować zainfekowane
maszyny</li>
</ul></li>
<li>Botnet - wiele zainfekowanych maszyn pod kontrolą jednej
osoby/organizacji</li>
<li>Przykładowe komendy
<ul>
<li>wykonanie ataku DDoS</li>
<li>skanowanie w poszukiwaniu podatnych maszyn</li>
<li>uaktualnienie oprogramowania, pobranie dodatkowych narzędzi</li>
</ul></li>
<li>Zastosowania
<ul>
<li>rozsyłanie spamu</li>
<li>przprowadzanie ataków DDoS</li>
<li>zachęcanie do odwiedzania witryn</li>
<li>zdobywanie informacji o właścicielach zianfekowanych maszyn</li>
<li>wykradanie informaji</li>
<li>bezpośrednie zarabianie pieniędzy</li>
</ul></li>
<li>Komunikacja z serwerami C&amp;C
<ul>
<li>IRC</li>
<li>pobieranie pliku komend z serwera</li>
<li>sieci peer-to-peer</li>
<li>sieć TOR</li>
<li>proste rozwiązania dalej są używane ze względu na niższe koszty</li>
</ul></li>
</ul>
<h2 id="możliwości-złośliwego-oprogramowania">Możliwości złośliwego
oprogramowania</h2>
<ul>
<li>Ukrywanie infekcji
<ul>
<li>uniemożliwia pozbycie się robaka</li>
<li>zabijanie procesów związanych z antywirusami, firewall itd.</li>
<li>przekierowywanie ruchu sieciowego antywirusów na adres loopback
(plik <code>hosts</code>)</li>
</ul></li>
<li>Masowe infekowanie maszyn
<ul>
<li>auto-rooter</li>
<li>wykorzystują wiele podatności</li>
<li>funkcjonalnośc backdoor’a</li>
</ul></li>
<li>Logowanie naciskanych klawiszy
<ul>
<li>wykradanie loginów i haseł</li>
</ul></li>
<li>Dostęp do obrazu z kamery internetowej</li>
</ul>
<h2 id="zeuscitadel">Zeus/Citadel</h2>
<ul>
<li>Złośliwe oprogramowanie dedykowane wykradaniu informacji służących
do logowania oraz danych finansowych</li>
<li>Crime as a service</li>
<li>Zawiera narzędzie umożliwiające personalizację trojana</li>
<li>Wykradanie informacji z
<ul>
<li>plików cookie przeglądarek i flash’a</li>
<li>klientów FTP</li>
<li>klientów pocztowych</li>
</ul></li>
<li>Man in the browser
<ul>
<li>system hooks w przeglądarce pozwalają wywołać funkcje systemu
operacyjnego</li>
<li>umożliwia podsłuchiwanie komunikacje nawet przy szyfrowanym
kanale</li>
</ul></li>
<li>Money mules</li>
</ul>
<h2 id="ransomware">Ransomware</h2>
<ul>
<li>Złośliwe oprogramowanie blokujące dostęp do komputera i domagające
się okupu</li>
<li>Dwie wersje
<ul>
<li>blokująca dostęp do komputera - WinLocker</li>
<li>szyfrująca istotne dane ofiary (ew. groźba ich opublikowania) -
CryptoLocker</li>
</ul></li>
<li>Dobry interes od czasu spopularyzowania się bitcoina do
płatności</li>
<li>Aktualnie najpopularniejszy sposób zarabiania</li>
<li>Przy dobrym schemacie działania jest nie do złamania</li>
</ul>

        </main>
    </div>
    <div class="table-of-contents">
        <nav id="TOC" role="doc-toc">
<ul>
<li><a href="#malware">Malware</a>
<ul>
<li><a href="#złośliwy-kod">Złośliwy kod</a></li>
<li><a href="#podstawowe-pojęcia">Podstawowe pojęcia</a></li>
<li><a href="#rodzaje-shellcode">Rodzaje shellcode</a>
<ul>
<li><a href="#port-bind-connect-back">Port-bind, connect-back</a></li>
<li><a href="#download-and-execute">Download and execute</a></li>
<li><a href="#egg-hunt">Egg hunt</a></li>
</ul></li>
<li><a href="#shellcode-a-zwykły-program">Shellcode a zwykły
program</a></li>
<li><a href="#uruchomienie-programu-w-formacie-pe">Uruchomienie programu
w formacie PE</a></li>
<li><a href="#mechanizmy-stosowane-w-shellcode">Mechanizmy stosowane w
shellcode</a>
<ul>
<li><a href="#peb">PEB</a></li>
</ul></li>
<li><a href="#motywacje-atakujących">Motywacje atakujących</a>
<ul>
<li><a href="#sposoby-na-zarabianie">Sposoby na zarabianie</a></li>
</ul></li>
<li><a href="#botnet">Botnet</a></li>
<li><a href="#możliwości-złośliwego-oprogramowania">Możliwości
złośliwego oprogramowania</a></li>
<li><a href="#zeuscitadel">Zeus/Citadel</a></li>
<li><a href="#ransomware">Ransomware</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>
</body>
</html>