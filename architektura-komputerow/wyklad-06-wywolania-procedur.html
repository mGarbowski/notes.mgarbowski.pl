<!doctype html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>wyklad-06-wywolania-procedur</title>
    <link rel="stylesheet" href="../style.css">

    <!--    Load mathjax from cdn to render latex equations-->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<div class="prev-next-links">
    
    <div class="index-links-prev">
        <a href="wyklad-05-programmowy-model-uzytkowy.html">Poprzedni: wyklad-05-programmowy-model-uzytkowy.html</a>
    </div>
    

    
    <div class="index-links-next">
        <a href="wyklad-07-budowa-modelu-programowego.html">Następny: wyklad-07-budowa-modelu-programowego.html</a>
    </div>
    
    <div class="return-link">
        <a href="..">Powrót</a>
    </div>
</div>
<div class="container">
    <div class="index-links-wrapper">
        <h2>Architektura komputerów</h2>
        <div class="index-links">
            <ul>
                
                <li><a href="wyklad-01-wstep.html">wyklad-01-wstep.html</a></li>
                
                <li><a href="wyklad-02-klasyfikacja-pamieci.html">wyklad-02-klasyfikacja-pamieci.html</a></li>
                
                <li><a href="wyklad-03-dane-alfanumeryczne.html">wyklad-03-dane-alfanumeryczne.html</a></li>
                
                <li><a href="wyklad-04-reprezentacja-danych-w-pamieci.html">wyklad-04-reprezentacja-danych-w-pamieci.html</a></li>
                
                <li><a href="wyklad-05-programmowy-model-uzytkowy.html">wyklad-05-programmowy-model-uzytkowy.html</a></li>
                
                <li><a href="wyklad-06-wywolania-procedur.html">wyklad-06-wywolania-procedur.html</a></li>
                
                <li><a href="wyklad-07-budowa-modelu-programowego.html">wyklad-07-budowa-modelu-programowego.html</a></li>
                
                <li><a href="wyklad-08-risc-v.html">wyklad-08-risc-v.html</a></li>
                
                <li><a href="wyklad-09-konsolidacja.html">wyklad-09-konsolidacja.html</a></li>
                
                <li><a href="wyklad-10-intel-x86.html">wyklad-10-intel-x86.html</a></li>
                
                <li><a href="wyklad-11-intel-x86.html">wyklad-11-intel-x86.html</a></li>
                
                <li><a href="wyklad-12-intel-x86.html">wyklad-12-intel-x86.html</a></li>
                
                <li><a href="wyklad-13-komputer-jednocyklowy.html">wyklad-13-komputer-jednocyklowy.html</a></li>
                
                <li><a href="wyklad-14-komputer-wielocyklowy.html">wyklad-14-komputer-wielocyklowy.html</a></li>
                
                <li><a href="wyklad-16-potokowe-jednostki-wykonawcze.html">wyklad-16-potokowe-jednostki-wykonawcze.html</a></li>
                
                <li><a href="wyklad-18-kieszenie.html">wyklad-18-kieszenie.html</a></li>
                
                <li><a href="wyklad-19-wydajnosc.html">wyklad-19-wydajnosc.html</a></li>
                
                <li><a href="wyklad-20-zarzadzanie-zasobami.html">wyklad-20-zarzadzanie-zasobami.html</a></li>
                
                <li><a href="wyklad-22-wyjatki.html">wyklad-22-wyjatki.html</a></li>
                
                <li><a href="wyklad-23-wejscie-wyjscie.html">wyklad-23-wejscie-wyjscie.html</a></li>
                
                <li><a href="wyklad-24-budowa-komputera.html">wyklad-24-budowa-komputera.html</a></li>
                
                <li><a href="zadania.html">zadania.html</a></li>
                
            </ul>
        </div>
    </div>
    <div class="content-wrapper">
        <main>
            <p>Jeśli strona była dla Ciebie pomocna, możesz wesprzeć mnie w jej utrzymaniu na <a href="https://buycoffee.to/mgarbowski">buycoffee.to/mgarbowski</a></p>
            <h1 id="wykład-06-2023-03-08">Wykład 06 (2023-03-08)</h1>
<h2 id="wywołanie-funkcji-procedury">Wywołanie funkcji / procedury</h2>
<ol type="1">
<li>Włożenie argumentów na stos
<ul>
<li>W C, najpierw ostatni, pierwszy na wierzchołku stosu</li>
</ul></li>
<li>Skok ze śladem</li>
</ol>
<p>Powrót - załadowanie wierzchołka stosu (śladu) do PC, przed powrotem
wszystkie zmienne lokalne są niszczone. Ma sens tylko wtedy kiedy na
wierzchołku stosu leży ślad.</p>
<p>Według konwencji C, za niszczenie argumentów (zdjęcie ze stosu)
odpowiada funkcja wołająca</p>
<h2 id="realizacja-stosu">Realizacja stosu</h2>
<p>Przykładowa, prosta, współcześnie robi się bardziej wydajnie</p>
<ul>
<li>Pojedynczy, ciągły obszar w przestrzeni adresowej</li>
<li>Adres wierzchołka stosu jest trzymany w specjalnym rejestrze (SP -
Stack Pointer)
<ul>
<li>typowo wierzchołek oznacza adres ostatnio wwpechniętej danej</li>
<li>typowo rośnie w kierunku mniejszych adresów</li>
</ul></li>
<li>Operacje
<ul>
<li>PUSH - zmniejszenie SP o rozmiar danej i umieszczenie jej pod
podanym adresem</li>
<li>POP - zdjęcie danej ze stosu i potem zwiększenie SP</li>
</ul></li>
</ul>
<p>Stworzenie / zniszczenie zmiennej - zmiana PC ale dane zostają w
pamięci, znikają z punktu widzenia programu, zainicjowana zmienna ma
taką wartość jaka ostatnio była tam w pamięci,
<code>PC+=sizeof(data)</code>, <code>PC-=sizeof(data)</code></p>
<h2 id="sekcja-statyczna">Sekcja statyczna</h2>
<p>Przed uruchomoieniem programu adres każdej danej statycznej (TEXT,
zmienne statyczne) jest dokładnie znany. Assembler tłumaczy symboliczną
nazwę procedury na konkretną wartość liczbową - adres.</p>
<p>Ostateczną konsolidację programu robi współcześnie system operacyjny
(Address Space Randomization)</p>
<h2 id="sekcja-dynamiczna">Sekcja dynamiczna</h2>
<p>Obiekty dynamiczne nie mają stałych adresów, nie mogą być znane przed
uruchomieniem</p>
<ul>
<li>argumenty i zmienne lokalne procedur</li>
<li>obiekty alokowane na stercie</li>
<li>zmienne statyczne wątku</li>
<li>zmienne statyczne bilbiotek współdzielonych</li>
</ul>
<h2 id="promocja-całkowitoliczbowa">Promocja całkowitoliczbowa</h2>
<p>Dotyczy tylko argumentów procedur</p>
<p>Dla procesora 32-bitowego * adresy są 32-bitowe i typ int ma 32 bity
* obowiązuje wyrównanie naturalne * wszystkie dane krótsze niż int
zajmują na stosie tyle co int</p>
<h2 id="ramka-stosu">Ramka stosu</h2>
<p>Procedura ma dostęp do zmiennych globalnych i do własnych zmiennych
lokalnych - własny kawałek stosu - ramka stosu procedury</p>
<p>Argumenty + ślad -&gt; rekord aktywacji procedury</p>
<p>Adresowanie danych w ramce stosu -&gt; jako suma SP i stałej
(przesunięcie). Jeśli nie jest procedurą liściem to wartość wierzhołka
stosu może się zmienić i trzeba użyć innych przesunięć, kompilator może
to wyliczyć, trudno to debuggować</p>

        </main>
    </div>
    <div class="table-of-contents">
        <nav id="TOC" role="doc-toc">
<ul>
<li><a href="#wykład-06-2023-03-08">Wykład 06 (2023-03-08)</a>
<ul>
<li><a href="#wywołanie-funkcji-procedury">Wywołanie funkcji /
procedury</a></li>
<li><a href="#realizacja-stosu">Realizacja stosu</a></li>
<li><a href="#sekcja-statyczna">Sekcja statyczna</a></li>
<li><a href="#sekcja-dynamiczna">Sekcja dynamiczna</a></li>
<li><a href="#promocja-całkowitoliczbowa">Promocja
całkowitoliczbowa</a></li>
<li><a href="#ramka-stosu">Ramka stosu</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>
</body>
</html>